import { createContext, useState, useContext, useEffect } from 'react';
import enTranslations from '../locales/en.json';
import skTranslations from '../locales/sk.json';

const LanguageContext = createContext();

// Dictionary of translations for the application
export const translations = {
  sk: {
    ...skTranslations,
    // Legacy translations not yet moved to JSON files
    // Header
    lightMode: "Svetl√Ω re≈æim",
    darkMode: "Tmav√Ω re≈æim",
    autoRefreshOn: "Auto-refresh: Zap",
    autoRefreshOff: "Auto-refresh: Vyp",
    
    // Sidebar
    sidebarTitle: "Ovl√°dac√≠ Panel",
    chartsAndVisualizations: "Grafy a vizualiz√°cie",
    dataAggregations: "Agreg√°cie d√°t",
    thresholdSettings: "Nastavenia prahov",
    heatmapSettings: "Kobercov√Ω graf",
    
    // Settings categories
    navigation: "Navig√°cia",
    actions: "Akcie",
    account: "√öƒçet",
    
    // Chart types and fields
    temperature: "üå°Ô∏è Teplota",
    humidity: "üíß Vlhkos≈•",
    pressure: "üß≠ Tlak",
    heatmap: "üìä Kobercov√Ω graf",
    minValues: "Minim√°lne hodnoty",
    avgValues: "Priemern√© hodnoty",
    maxValues: "Maxim√°lne hodnoty",
    merged: "Zl√∫ƒçen√Ω",
    separate: "Separ√°tne",
    mergedTitle: "Zl√∫ƒçi≈• v≈°etky d√°ta do jedn√©ho grafu",
    separateTitle: "Zobrazi≈• ka≈æd√Ω senzor zvl√°≈°≈•",
    
    // Locations
    locationSelector: "V√Ωber lok√°cie",
    allLocations: "V≈°etky lok√°cie",
    selectLocations: "Vybra≈• lok√°cie",
    noLocationsSelected: "Zru≈°i≈• v√Ωber v≈°etk√Ωch",
    selectedLocations: "Vybran√© lok√°cie",
    clearSelection: "Zru≈°i≈• v√Ωber v≈°etk√Ωch lok√°ci√≠",
    
    // Time ranges
    timeRange: "ƒåasov√Ω rozsah",
    live: "LIVE",
    custom: "Vlastn√Ω interval",
    customRange: "Vlastn√Ω ƒçasov√Ω rozsah",
    from: "Od",
    to: "Do",
    apply: "Pou≈æi≈•",
    cancelTimeRange: "Zru≈°i≈•",
    
    // Buttons
    hide: "Skry≈•",
    edit: "Upravi≈•",
    show: "Zobrazi≈•",
    hideThresholds: "Skry≈• prahy v grafoch",
    showThresholds: "Zobrazi≈• prahy v grafoch",
    showDayLabels: "Zobrazi≈• popisky dn√≠",
    switchToCalendar: "Prepn√∫≈• na Calendar Heatmap",
    switchToMatrix: "Prepn√∫≈• na Matrix Heatmap",
    
    // Thresholds descriptions
    thresholdMin: "Minim√°lny prah",
    thresholdMid: "Stredn√Ω prah",
    thresholdHigh: "Vysok√Ω prah",
    colorMin: "Farba n√≠zkeho prahu",
    colorMid: "Farba stredn√©ho prahu",
    colorHigh: "Farba vysok√©ho prahu",
    
    // Display modes
    displayMode: "Zobrazenie grafov",
    chartMode: "Re≈æim grafov",
    
    // Status
    lastSeen: "Naposledy viden√Ω",
    
    // Full Screen
    fullscreen: "Na cel√∫ obrazovku",
    exitFullscreen: "Zavrie≈• cel√∫ obrazovku",
    
    // Export
    export: "Export",
    exportExcel: "Export Excel",
    exportCSV: "Export CSV",
    exportError: "Chyba pri exporte, sk√∫ste znova",
    format: "form√°t",
    
    // Loading and error states
    error: "Chyba",
    
    // Confirmation
    confirmation: "Potvrdenie",
    confirm: "Potvrdi≈•",
    cancelAction: "Zru≈°i≈•",
    warning: "Upozornenie",
    
    // Help texts
    chartsHelpText: "V√Ωber typov √∫dajov a sp√¥sobu ich zobrazenia.",
    aggregationsHelpText: "Zobrazenie minim√°lnych, priemern√Ωch a maxim√°lnych hodn√¥t v grafoch.",
    thresholdsHelpText: "Nastavenie farebne oznaƒçen√Ωch hran√≠c pre meran√© hodnoty.",
    heatmapHelpText: "Zobrazuje historick√© hodnoty vo form√°te matice alebo kalend√°ra.",
    cardStylingHelpText: "Upravte vzhƒæad kariet senzorov nastaven√≠m farieb a priehƒæadnosti.",
    locationColorsHelpText: "Nastavte farby pre jednotliv√© lokality, ktor√© sa premietnu do kariet aj grafov.",
    
    // Card styling
    cardStyling: "≈†t√Ωl kariet",
    backgroundColor: "Farba pozadia",
    borderColor: "Farba okraja",
    opacity: "Priehƒæadnos≈•",
    previewCard: "Uk√°≈ækov√° karta",
    resetToDefault: "Obnovi≈• predvolen√©",
    
    // Location colors
    locationColors: "Farby lokal√≠t",
    defaultColor: "Predvolen√° farba",
    color: "Farba",
    editLocationColor: "Upravi≈• farbu pre {{location}}",
    locationColorsDescription: "Prisp√¥sobte si farby pre ka≈æd√∫ lokalitu v kart√°ch senzorov aj v grafoch.",
    resetToDefaultColors: "Obnovi≈• predvolen√© farby",
    save: "Ulo≈æi≈•",
    
    // Other
    noData: "≈Ωiadne d√°ta",
    settings: "Nastavenia",
    defaultSelection: "Predvolen√Ω v√Ωber",
    defaultSelectionHelpText: "Nastavte aktu√°lny v√Ωber ako predvolen√Ω pri naƒç√≠tan√≠.",
    setCurrentSelectionAsDefault: "Nastavi≈• aktu√°lny v√Ωber ako predvolen√Ω",
    defaultSelectionSaved: "Aktu√°lny v√Ωber bol nastaven√Ω ako predvolen√Ω.",
    setAsDefault: "Nastavi≈• ako predvolen√©",
    day: "De≈à",
    month: "Mesiac",
    year: "Rok",
    
    // Admin Panel
    visible: "Viditeƒæn√©",
    hidden: "Skryt√©",
    uptimeChart: "Graf uptime",
    uptimeTotal: "Celkov√Ω uptime",
    selectRange: "Vybra≈• rozsah",
    noDataForRange: "≈Ωiadne d√°ta pre tento rozsah",
    generatingFile: "Generujem s√∫bor...",
    hideShowLocations: "Skry≈•/Zobrazi≈• lok√°cie",
    hideShowCards: "Skry≈•/Zobrazi≈• karty",
    noSensorsFound: "≈Ωiadne senzory neboli n√°jden√©",
    moveUp: "Posun√∫≈• hore",
    moveDown: "Posun√∫≈• dole",
    dragging: "Pres√∫vanie...",
    dropHere: "Pusti≈• sem",
    dragDropHint: "Lokality m√¥≈æete pres√∫va≈• ≈•ahan√≠m alebo pomocou ≈°√≠pok",
    
    // Sensor card tooltips
    temperatureTooltip: "Teplota",
    humidityTooltip: "Vlhkos≈•",
    pressureTooltip: "Tlak",
    lastRecordTooltip: "Posledn√Ω z√°znam",
    onlineTooltip: "Online",
    offlineTooltip: "Offline",
    sensorInfoTooltip: "Inform√°cie o senzore",
    noDataAvailable: "≈Ωiadne √∫daje",
    dataAvailableOnlyInLive: "√ödaj dostupn√Ω iba v LIVE rozsahu",
    
    // Timeline visualization in admin panel
    blankIsOffline: "Pr√°zdne miesta znamenaj√∫ offline",
    dataAggregated: "D√°ta s√∫ agregovan√©",
    opacityShows: "priehƒæadnos≈• zobrazuje percentu√°lny ƒças online",
    
    // Uptime information
    uptime: "Uptime",
    offline: "Offline",
    since: "Od",
    totalRuntime: "Celkov√Ω beh"
  },
  en: {
    ...enTranslations,
    // Legacy translations not yet moved to JSON files
    // Header
    lightMode: "Light Mode",
    darkMode: "Dark Mode",
    autoRefreshOn: "Auto-refresh: On",
    autoRefreshOff: "Auto-refresh: Off",
    
    // Sidebar
    sidebarTitle: "Dashboard Controls",
    chartsAndVisualizations: "Charts & Visualizations",
    dataAggregations: "Data Aggregations",
    thresholdSettings: "Threshold Settings",
    heatmapSettings: "Heatmap Settings",
    
    // Settings categories
    navigation: "Navigation",
    actions: "Actions",
    account: "Account",
    
    // Chart types and fields
    temperature: "üå°Ô∏è Temperature",
    humidity: "üíß Humidity",
    pressure: "üß≠ Pressure",
    heatmap: "üìä Heatmap",
    minValues: "Minimum Values",
    avgValues: "Average Values",
    maxValues: "Maximum Values",
    merged: "Merged",
    separate: "Separate",
    mergedTitle: "Merge all data into one chart",
    separateTitle: "Show each sensor separately",
    
    // Locations
    locationSelector: "Location Selector",
    allLocations: "All Locations",
    selectLocations: "Select Locations",
    noLocationsSelected: "Clear All Selections",
    selectedLocations: "Selected locations",
    clearSelection: "Clear all location selections",
    
    // Time ranges
    timeRange: "Time Range",
    live: "LIVE",
    custom: "Custom Range",
    customRange: "Custom Time Range",
    from: "From",
    to: "To",
    apply: "Apply",
    cancelTimeRange: "Cancel",
    
    // Buttons
    hide: "Hide",
    edit: "Edit",
    show: "Show",
    hideThresholds: "Hide thresholds in charts",
    showThresholds: "Show thresholds in charts",
    showDayLabels: "Show day labels",
    switchToCalendar: "Switch to Calendar Heatmap",
    switchToMatrix: "Switch to Matrix Heatmap",
    
    // Thresholds descriptions
    thresholdMin: "Minimum threshold",
    thresholdMid: "Middle threshold",
    thresholdHigh: "High threshold",
    colorMin: "Low threshold color",
    colorMid: "Middle threshold color",
    colorHigh: "High threshold color",
    
    // Display modes
    displayMode: "Chart Display Mode",
    chartMode: "Chart Mode",
    
    // Status
    lastSeen: "Last seen",
    
    // Full Screen
    fullscreen: "Full Screen",
    exitFullscreen: "Exit Full Screen",
    
    // Export
    export: "Export",
    exportExcel: "Export Excel",
    exportCSV: "Export CSV",
    exportError: "Error exporting, please try again",
    format: "format",
    
    // Loading and error states
    error: "Error",
    
    // Confirmation
    confirmation: "Confirmation",
    confirm: "Confirm",
    cancelAction: "Cancel",
    warning: "Warning",
    
    // Help texts
    chartsHelpText: "Select data types and how to display them.",
    aggregationsHelpText: "Display minimum, average, and maximum values in charts.",
    thresholdsHelpText: "Set color-coded boundaries for measured values.",
    heatmapHelpText: "Display historical values in a matrix or calendar format.",
    cardStylingHelpText: "Customize the appearance of sensor cards by setting colors and opacity.",
    locationColorsHelpText: "Set colors for individual locations that will be reflected in cards and charts.",
    
    // Card styling
    cardStyling: "Card Styling",
    backgroundColor: "Background Color",
    borderColor: "Border Color",
    opacity: "Opacity",
    previewCard: "Preview Card",
    resetToDefault: "Reset to Default",
    
    // Location colors
    locationColors: "Location Colors",
    defaultColor: "Default Color",
    color: "Color",
    editLocationColor: "Edit color for {{location}}",
    locationColorsDescription: "Customize colors for each location in sensor cards and charts.",
    resetToDefaultColors: "Reset to Default Colors",
    save: "Save",
    
    // Other
    noData: "No Data",
    settings: "Settings",
    defaultSelection: "Default Selection",
    defaultSelectionHelpText: "Set current selection as default on load.",
    setCurrentSelectionAsDefault: "Set Current Selection as Default",
    defaultSelectionSaved: "Current selection has been set as default.",
    setAsDefault: "Set as Default",
    day: "Day",
    month: "Month",
    year: "Year",
    
    // Admin Panel
    visible: "Visible",
    hidden: "Hidden",
    uptimeChart: "Uptime Chart",
    uptimeTotal: "Total Uptime",
    selectRange: "Select Range",
    noDataForRange: "No data for this range",
    generatingFile: "Generating file...",
    hideShowLocations: "Hide/Show Locations",
    hideShowCards: "Hide/Show Cards",
    noSensorsFound: "No sensors found",
    moveUp: "Move Up",
    moveDown: "Move Down",
    dragging: "Dragging...",
    dropHere: "Drop here",
    dragDropHint: "You can rearrange locations by dragging or using arrows",
    
    // Sensor card tooltips
    temperatureTooltip: "Temperature",
    humidityTooltip: "Humidity",
    pressureTooltip: "Pressure",
    lastRecordTooltip: "Last record",
    onlineTooltip: "Online",
    offlineTooltip: "Offline",
    sensorInfoTooltip: "Sensor Information",
    noDataAvailable: "No data available",
    dataAvailableOnlyInLive: "Data only available in LIVE range",
    
    // Timeline visualization in admin panel
    blankIsOffline: "Blank periods are offline",
    dataAggregated: "Data is aggregated",
    opacityShows: "opacity shows percentage of time online",
    
    // Uptime information
    uptime: "Uptime",
    offline: "Offline",
    since: "Since",
    totalRuntime: "Total runtime"
  }
};

export function LanguageProvider({ children }) {
  // Default language is Slovak (sk)
  const [language, setLanguage] = useState('sk');
  
  // Load language preference from localStorage on initial mount
  useEffect(() => {
    const savedLanguage = localStorage.getItem('language');
    if (savedLanguage && (savedLanguage === 'sk' || savedLanguage === 'en')) {
      setLanguage(savedLanguage);
    }
  }, []);
  
  // Save language preference whenever it changes
  useEffect(() => {
    localStorage.setItem("language", language);
  }, [language]);
  
  // Toggle between Slovak and English
  const toggleLanguage = () => setLanguage(prev => prev === 'sk' ? 'en' : 'sk');
  
  // Get a translation value
  const t = (key) => {
    // First check if the key exists in the current language
    if (translations[language][key]) {
      return translations[language][key];
    }
    
    // If not found in current language, check the other language
    const otherLang = language === 'sk' ? 'en' : 'sk';
    if (translations[otherLang][key]) {
      return translations[otherLang][key];
    }
    
    // If not found in either language, return the key itself
    console.warn(`Translation missing for key: ${key}`);
    return key;
  };
  
  const value = {
    language,
    setLanguage,
    toggleLanguage,
    t
  };
  
  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
} 